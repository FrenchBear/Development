<HTML>
<META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.rsac.org/ratingsv01.html" l gen true comment "RSACi North America Server" by "RodStephens@vb-helper.com" for "http://www.vb-helper.com" on "1998.03.17T18:18-0800" r (n 0 s 0 v 0 l 0))'>
<HEAD>
<TITLE>VB Helper: HowTo: Use the TypeLib routine Invokehook to find a control's name and invoke a routine</TITLE>
<META NAME="Author" CONTENT="Rod Stephens">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META HTTP-EQUIV="Keywords" CONTENT="TypeLib, InvokeHook, get name">
<META NAME="Keywords" CONTENT="TypeLib, InvokeHook, get name">
<META NAME="Description" CONTENT="VB Helper: HowTo: Use the TypeLib routine Invokehook to find a control's name and invoke a routine">
<META NAME="Copyright" CONTENT="Copyright 1997-2003, Rocky Mountain Computer Consulting, Inc.">
<META NAME="Rating" CONTENT="General">
<META NAME="Robots" CONTENT="All">
</HEAD>

<BODY BGCOLOR="#E1F3FF" BACKGROUND="bg_blue.jpg">

  <!-- This table contains the banner, menu column, and content. -->
  <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
    <!-- ****** -->
    <!-- Banner -->
    <!-- ****** -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0" ALIGN="Left">
        <TR>
          <TD BACKGROUND="banner_mid.jpg"><IMG SRC="banner_l.jpg" WIDTH="410" HEIGHT="64"></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="banner_r.jpg" WIDTH="32" HEIGHT="64"></TD>
        </TR>
      </TABLE>
    </TD></TR>
    <TR><TD>&nbsp;</TD></TR>

    <!-- Menu column and content -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="2" CELLPADDING="0">
        <!-- *********** -->
        <!-- Menu column -->
        <!-- *********** -->
        <TR>
          <TD ALIGN="Left" VALIGN="Top">
            <TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- Menu top -->
              <TR>
                <TD><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_um.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <!-- Menu entries -->
              <TR BGCOLOR="#7FCFFF">
                <TD BACKGROUND="blue_l.jpg" WIDTH="16">&nbsp;</TD>
                <TD><CENTER>
                  <A HREF="index.html"><B><FONT SIZE="+1">Home</FONT></B></A><BR>
                  <A HREF="search.html"><B>Search</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="whats_new.html"><B>What's New</B></A><BR>
                  <A HREF="index_categories.html"><B>Index</B></A><BR>
                  <A HREF="books.html"><B>Books</B></A><BR>
                  <A HREF="links.html"><B>Links</B></A><BR>
                  <A HREF="http://www.topica.com/lists/VBHelperQA/read"><B>Q &amp; A</B></A><BR>
                  <A HREF="newsletter.html"><B>Newsletter</B></A><BR>
                  <A HREF="banners.html"><B>Banners</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="mailto:feedback@vb-helper.com"><B>Feedback</B></A><BR>
                  <A HREF="tip_jar.html"><B>Tip Jar</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="feed.xml"><IMG SRC="xml_rss.jpg" BORDER="0" ALT="XML RSS Feed"></A><BR>
                </CENTER></TD>
                <TD BACKGROUND="blue_r.jpg" WIDTH="16">&nbsp;</TD>
              </TR>

              <!-- Menu bottom -->
              <TR>
                <TD><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lm.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ***************** -->
              <!-- Amazon Recommends -->
              <!-- ***************** -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<!-- -->
                <SCRIPT SRC="http://rcm.amazon.com/e/cm?t=vbhelper&l=rc1&p=2&o=1" TYPE="text/JavaScript"></SCRIPT>
<!-- -->
                <NOSCRIPT>
                  <TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="125">
                    <TR><TD>
                      <MAP NAME="boxmap">
                        <AREA SHAPE="RECT" COORDS="18, 263, 105, 274" HREF="http://rcm.amazon.com/e/cm/privacy-policy.html?o=1">
                        <AREA COORDS="0,0,10000,10000" HREF="http://www.amazon.com/exec/obidos/redirect-home/vbhelper">
                      </MAP>
                      <img src="http://rcm-images.amazon.com/images/G/01/associates/amzn_recommends/gnbox125x275.gif" width="125" height="275" border="0" usemap="#boxmap">
                    </TD></TR>
                  </TABLE>
                </NOSCRIPT>
              </TD></TR>
              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ******** -->
              <!-- Partners -->
              <!-- ******** -->
              <!-- NetFlix -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<img src="http://service.bfast.com/bfast/serve?bfmid=27276611&siteid=40161029&bfpage=hldy125x125" border="0" width="1" height="1" NOSAVE >
<a href="http://service.bfast.com/bfast/click?bfmid=27276611&siteid=40161029&bfpage=hldy125x125" target="_top"><img src="http://a408.g.akamai.net/f/408/1284/24h/image.netflix.com/NetFlix_Assets/affiliates/banners/stockhouse1103_125125A.gif" border="0" width="125" height="125" alt=""></a>
              </TR></TD>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Wiley -->
              <TR><TD COLSPAN="3" ALIGN="Center" BACKGROUND="sandpaper.gif"><A HREF="http://service.bfast.com/bfast/click?bfmid=37920629&siteid=40078832&bfpage=computer_science" TARGET="_top"><IMG SRC="wiley_logo.gif" BORDER="0" ALIGN="Center" WIDTH="77" HEIGHT="105"></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Que -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="http://www.quepublishing.com"><IMG SRC="que.gif" BORDER="0" ALIGN="Center" WIDTH="121" HEIGHT="36"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Amazon -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="amazon.html"><IMG SRC="amazon_logo.gif" BORDER="0" ALIGN="Center" WIDTH="68" HEIGHT="65"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ********** -->
              <!-- More stuff -->
              <!-- ********** -->

            </TABLE>
          </TD>

          <!-- A little space between the menus and content -->
          <TD WIDTH="5">&nbsp;</TD>

          <!-- ******* -->
          <!-- Content -->
          <!-- ******* -->
          <TD WIDTH="100%" ALIGN="Left" VALIGN="Top">
            <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- How To Summary -->
              <TR><TD>
                <TABLE WIDTH="100%" BORDER="2" CELLSPACING="0" CELLPADDING="2">
                  <TR><TH ALIGN="Left">Title</TH><TD WIDTH="100%">Use the TypeLib routine Invokehook to find a control's name and invoke a routine</TD></TR>
                  <TR><TH ALIGN="Left">Description</TH><TD WIDTH="100%">This example shows how to use the TypeLib routine InvokeHook to find a control's name and invoke a routine in Visual Basic 6. It uses the InvokeHook method with the INVOKE_PROPERTYGET command to invoke the control's Name property. It uses the INVOKE_FUNC command to invoke the routine.</TD></TR>
                  <TR><TH ALIGN="Left">Keywords</TH><TD>TypeLib, InvokeHook, get name</TD></TR>
                  <TR><TH ALIGN="Left">Categories</TH><TD>Software Engineering, Controls</TD></TR>
                </TABLE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
Thanks to <A HREF="mailto:oigres@postmaster.co.uk">Sergio Perciballi</A>.
<P>
The program needs a reference to typelib information (tLbinf32.dll). MSDN has tLbinf32.dll documentation in addons area http://msdn.microsoft.com/vbasic/downloads/addon.asp and http://msdn.microsoft.com/vbasic/downloads/download.asp?ID=094. Sergio says "If you can understand this documentation then you must be a COM programmer!"
<P>
The hook subroutine calls InvokeHook, passing it a control, the name of the property to invoke (Name), and the INVOKE_PROPERTY command.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2">Private m_TLInf As TypeLibInfo

Sub hook()
    Dim ret As Variant
    <FONT COLOR="#008000">'The Invoke members of the TLIApplication object</FONT>
    <FONT COLOR="#008000">'allow you to easily use IDispatch::Invoke directly</FONT>
    <FONT COLOR="#008000">' from VB code</FONT>
    <FONT COLOR="#008000">'This has similar functionality to the VB6 callbyname</FONT>
    <FONT COLOR="#008000">' function</FONT>
    <FONT COLOR="#008000">'I left out The ReverseArg();ret receives the property</FONT>
    <FONT COLOR="#008000">' value</FONT>
    
    ret = tli.InvokeHook(Me.TxtThisIsTheName, "Name", _
        INVOKE_PROPERTYGET)
    MsgBox "The name of this textbox is '" &amp; ret &amp; "'"
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
Subroutine hook2 invokes the form's foo subroutine. It calls InvokeHook passing it the name of the object (the form), the name of the method to invoke (foo), the INVOKE_FUNC command, and an array of arguments for the foo method.
<P>
The foo method displays its arguments.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2">Sub hook2()
    <FONT COLOR="#008000">'call a function of form1 object</FONT>
    <FONT COLOR="#008000">'foo(integer,integer array)</FONT>
    <FONT COLOR="#008000">'Function call takes 2 arguments</FONT>
    
    Dim tli As TLIApplication
    Set tli = New TLIApplication
    Dim arg() As Variant, iarr() As Integer
    Dim i As Integer
    Dim vt As Integer
    ReDim args(1): ReDim iarr(1)

    iarr(0) = 77: iarr(1) = 12345
    <FONT COLOR="#008000">'arguments for function are in reverse order: Order</FONT>
    <FONT COLOR="#008000">' that IDispatch::Invoke wants them</FONT>
    <FONT COLOR="#008000">'pointer to the integer array put in arg  array which</FONT>
    <FONT COLOR="#008000">' ia a variant array</FONT>
    args(0) = VarPtrArray(iarr)
    <FONT COLOR="#008000">'In order to support ByRef parameters with</FONT>
    <FONT COLOR="#008000">' InvokeHookArray,</FONT>
    <FONT COLOR="#008000">'you'll have to modify the Variants in the argument</FONT>
    <FONT COLOR="#008000">' list by assigning a Long pointer value to the</FONT>
    <FONT COLOR="#008000">' Variant, then using the CopyMemory API to modify the</FONT>
    <FONT COLOR="#008000">' vt (VarType) field in the underlying Variant</FONT>
    <FONT COLOR="#008000">' structure to be the VarType of the argument combined</FONT>
    <FONT COLOR="#008000">' with the VT_BYREF bit.</FONT>
    vt = VT_BYREF Or VT_ARRAY Or VT_I2
    CopyMemory args(0), vt, 2

    args(1) = VarPtr(i)
    vt = VT_BYREF Or VT_I2
    CopyMemory args(1), vt, 2

    tli.InvokeHookArray Form1, "Foo", INVOKE_FUNC, args
    Set tli = Nothing
End Sub

Sub foo(i As Integer, iarray() As Integer)
    Dim x As Integer
    MsgBox "In Foo subroutine: i= " &amp; i
    <FONT COLOR="#008000">''MsgBox "iarray(0) " &amp; iarray(0)</FONT>
    MsgBox "iarray count= " &amp; UBound(iarray) + 1
    <FONT COLOR="#008000">'assume Lbound=0</FONT>
    For x = 0 To UBound(iarray) <FONT COLOR="#008000">'- 1</FONT>
        MsgBox "iarray( " &amp; x &amp; ")= " &amp; iarray(x)
    Next x
End Sub</FONT></PRE>
              </TD></TR>

              <!-- *************** -->
              <!-- Download button -->
              <!-- *************** -->

              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>
              <TR><TD ALIGN="Center"><A HREF="HowTo/howto_typelib_invoke_name_method.zip"><IMG SRC="download.jpg" BORDER="0"></A></TD></TR>
              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>

            </TABLE> <!-- End content table -->
          </TD> <!-- End content column -->

          <!-- ************** -->
          <!-- Google AdSense -->
          <!-- ************** -->
          <TD WIDTH="120" ALIGN="Right" VALIGN="Top">
            <TABLE WIDTH="140" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <TR><TD ALIGN="Right">

<script type="text/javascript"><!--
google_ad_client = "pub-6627515316741006";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_channel ="3885326441";
google_color_border = ["5CAAFD","7ECFFE","00CC66","DDAADD"];
google_color_bg = ["7ECFFE","E1F3FF","99FF99","FFCCFF"];
google_color_link = ["0000FF","0000FF","0000FF","0000CC"];
google_color_url = ["008000","008000","0033FF","008000"];
google_color_text = ["000000","000000","000000","996699"];
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

              </TD></TR>
            </TABLE> <!-- End Google AdSense table -->
          </TD> <!-- End Google AdSense column -->


        </TR> <!-- End row containing menu column and content -->
      </TABLE> <!-- End table containing menu column and content -->
    </TD></TR>

    <!-- ****** -->
    <!-- Footer -->
    <!-- ****** -->
    <TR><TD WIDTH="100%">
      <TABLE WIDTH="100%" BORDER="0" BGCOLOR="#87CEFA" CELLSPACING="0" CELLPADDING="0">
        <!-- Top row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_um.jpg" COLSPAN="2" ALIGN="Center"><FONT SIZE="-2">
            Copyright &copy; 1997-2003 Rocky Mountain Computer Consulting, Inc. &nbsp; All rights reserved.
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>

        <!-- Bottom row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_lm.jpg"><FONT SIZE="-2">
            &nbsp;<SCRIPT LANGUAGE=JavaScript>document.write(document.URL)</SCRIPT></FONT></TD>
          <TD BACKGROUND="blue_lm.jpg" ALIGN="Right"><FONT SIZE="-2">
            Updated <SCRIPT LANGUAGE=JavaScript>document.write(document.lastModified)</SCRIPT> &nbsp;
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>
      </TABLE>
    </TD></TR>
  </TABLE> <!-- End table containing banner, menu column + content, and footer -->

</BODY>
</HTML>