<!DOCTYPE HTML>
<html>

<head>
    <title>Exercice, drawing a function</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: row;
            height: 100vh;
            margin: 0;
        }

        #controls {
            width: 350px;
            padding: 10px;
            overflow-y: auto;
            /* Show a scrollbar if needed */
            border-right: 1px solid #ccc;
        }

        #canvas-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: blanchedalmond;
        }

        canvas {
            border: 1px solid red;
            margin: 50px;
            /* width: 95vw;
            height: 95vh; */
        }

        fieldset {
            margin-bottom: 15px;
            background-color: hsl(30, 100%, 95%);
        }

        legend {
            border: 1px solid black;
            padding: 2.5px 5px;
            background-color: hsl(30, 100%, 90%);
            font-weight: 600;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input,
        select {
            box-sizing: border-box;
            width: 100%;
            margin-bottom: 10px;
        }

        .input-group {
            display: flex;
            /* Allow hside by side placement of label+input */
            gap: 10px;
        }
    </style>
</head>

<body>
    <div id="controls">
        <form id="controls-form">
            <fieldset id="xparams">
                <legend>Drawing area</legend>

                <div class="input-group">
                    <div>
                        <label for="xmin">XMin</label>
                        <input id="xmin" type="number" value="-2">
                    </div>
                    <div>
                        <label for="xmax">XMax</label>
                        <input id="xmax" type="number" value="2">
                    </div>
                </div>

                <div class="input-group">
                    <div>
                        <label for="ymin">YMin</label>
                        <input id="ymin" type="number" value="-1">
                    </div>
                    <div>
                        <label for="ymax">YMax</label>
                        <input id="ymax" type="number" value="5">
                    </div>
                </div>
            </fieldset>

            <fieldset id="fparams">
                <legend>Function</legend>

                <label>Function:</label>
                <select id="function">
                    <option value="sqr" selected>f(x) = x²</option>
                    <option value="sqrt">f(x) = √x</option>
                </select>

            </fieldset>
        </form>
    </div>

    <div id="canvas-container">
        <canvas id="canvas"></canvas>
    </div>

    <script>
        const form = document.getElementById("controls-form");
        const canvasContainer = document.getElementById('canvas-container');
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext('2d');

        config = {}

        function update_config() {
            let elements = form.elements;
            config.xmin = parseFloat(elements.xmin.value);
            config.xmax = parseFloat(elements.xmax.value);
            config.ymin = parseFloat(elements.ymin.value);
            config.ymax = parseFloat(elements.ymax.value);
            config.ftag = elements.function.value;

            console.log(`xmin: ${config.xmin}  xmax: ${config.xmax}`);
            console.log(`ymin: ${config.ymin}  ymax: ${config.ymax}`);
            console.log(`ftag: ${config.ftag}`);

            draw();
        }

        functions_dic = {
            "sqr": (x) => x * x,
            "sqrt": (x) => Math.sqrt(x),
        };

        function draw() {
            if (Object.keys(config).length == 0) return;

            if (config.ftag == null)
                return;
            let f = functions_dic[config.ftag];

            // let y = f(2);
            // console.log(`y=${y}`);
            // return;

            let nsteps = 100;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            console.log(`canvas: w=${canvas.width} h=${canvas.height}`);

            ctx.beginPath();
            let penup = true;
            for (let ix = 0; ix <= nsteps; ix++) {
                let x = config.xmin + (config.xmax - config.xmin) / nsteps * ix;
                let y = f(x);
                //console.log(`ix=${ix}     x=${x}, y=${y}`);

                // calculate canvas coordinates
                let xc = (x - config.xmin) / (config.xmax - config.xmin) * canvas.width;
                let yc = (y - config.ymin) / (config.ymax - config.ymin) * canvas.height;

                //console.log(`ix=${ix}     x=${x}, y=${y}    xc=${xc}, yc=${yc}`);

                if (penup) {
                    ctx.moveTo(xc, yc);
                    penup = false;
                } else {
                    ctx.lineTo(xc, yc);
                }
            }
            ctx.stroke();
        }

        function resizeCanvas() {
            // const size = Math.min(canvasContainer.clientWidth, canvasContainer.clientHeight) - 20;
            // canvas.width = size;
            // canvas.height = size;
            console.log('zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz')
            canvas.width = canvasContainer.clientWidth-20;
            canvas.height = canvasContainer.clientHeight-20;
            draw();
        }


        form.addEventListener('input', update_config);
        // window.addEventListener('resize', resizeCanvas);

        //resizeCanvas();     // Initial size
        update_config();    // Initial draw

    </script>

</body>

</html>